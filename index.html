<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lucky</title>
    <style>
      html,
      body {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: #ffa39e;
      }

      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      #root {
        position: absolute;
        left: 50%;
        top: 20%;
        width: 1600px;
        margin-left: -800px;
        z-index: 2;
      }
      #lucky {
        margin: 0 auto;
      }
      .h3 {
        width: 100%;
        text-align: center;
        margin-bottom: 100px;
        font-size: 60px;
        color: #fff;
      }
      @media screen and (max-width: 414px) {
        #root {
          width: 100%;
          left: 0;
          margin-left: initial;
        }
      }
    </style>
    <script src="https://unpkg.com/lucky-canvas@1.7.25"></script>
  </head>
  <body>
    <div id="root">
      <h1 class="h3">å—é—¨å°å­¦æœŸæœ«æŠ½å¥–</h1>
      <div id="lucky"></div>
    </div>
    <audio id="media_success" preload="auto">
      <source src="media/happy.mp3" type="audio/mp3" />
    </audio>
    <audio id="media_sorry" preload="auto">
      <source src="media/happy.mp3" type="audio/mp3" />
    </audio>
    <script>
      // è½¬ç›˜å˜é‡
      const lightColor = "#ffe58f";
      const weightColor = "#ffd666";
      const delay = 100; // è½¬ç›˜åœæ­¢å»¶è¿Ÿæ—¶é—´ å•ä½: ç§’

      // èƒŒæ™¯å˜é‡
      const bgColor = "#ffa39e"; // èƒŒæ™¯ç²‰è‰²
      const lineColor = "#fff"; // çº¿æ¡é¢œè‰² ç™½è‰²

      // æµè§ˆå™¨å®½åº¦
      const outerWidth = window.outerWidth;

      var currentIndex = null;

      // éŸ³æ•ˆ
      var media_success = document.getElementById("media_success");
      var media_sorry = document.getElementById("media_sorry");

      // å¥–å“åˆ—è¡¨
      const prizes = [
        {
          background: lightColor,
          fonts: [{ text: "å¡é€šæ©¡çš®", top: "50px", fontSize: "50px" }],
          weight: 0.25,
        },
        {
          background: weightColor,
          fonts: [{ text: "å¤ªç©ºäººä¸å€’ç¿", top: "50px", fontSize: "50px" }],
          weight: 0.25,
        },
        {
          background: lightColor,
          fonts: [{ text: "è´´çº¸å¡ç‰‡å¥–çŠ¶ä»»é€‰", top: "50px", fontSize: "50px" }],
          weight: 0.1,
        },
        {
          background: weightColor,
          fonts: [{ text: "æœŸæœ«æˆç»©A+", top: "50px", fontSize: "50px" }],
          weight: 0.3,
        },
        {
          background: "#ffffff",
          fonts: [{ text: "è°¢è°¢æƒ é¡¾", top: "50px", fontSize: "50px" }],
          weight: 0.1,
        },
      ];

      const weights = prizes.map((itm) => itm.weight);

      // æƒé‡ä¹‹å’Œ
      const totalWeight = weights.reduce((acc, curr) => acc + curr, 0);

      //æƒé‡å‡½æ•°
      function lottery() {
        const probability = Math.random();
        let cumulativeProbability = 0;
        for (let i = 0; i < weights.length; i++) {
          cumulativeProbability += weights[i] / totalWeight;
          if (probability < cumulativeProbability) {
            return i;
          }
        }
        return null;
      }
      // å®šæ—¶å™¨
      var timer = null;

      // è½¬ç›˜
      const myLucky = new LuckyCanvas.LuckyWheel("#lucky", {
        width: outerWidth < 414 ? "350px" : "900px",
        height: outerWidth < 414 ? "350px" : "900px",
        blocks: [{ padding: "20px", background: "#f5222d" }],
        prizes: prizes,
        buttons: [
          { radius: "40%", background: "#ffccc7" },
          { radius: "35%", background: "#ff7875" },
          {
            radius: "30%",
            background: "#f5222d",
            pointer: true,
            fonts: [{ text: "GO!", top: "-30px", fontSize: "50px" }],
          },
        ],
        start: function () {
          // å¼€å§‹æ¸¸æˆ
          myLucky.play();
          if (timer) {
            clearTimeout(timer);
            timer = null;
            currentIndex = null;
          }

          timer = setTimeout(() => {
            currentIndex = lottery();
            if (currentIndex !== null) {
              myLucky.stop(currentIndex);
            }
          }, delay);
        },
        end: function (prize) {
          var title = prizes[currentIndex].fonts[0].text;
          var txt = "æ­å–œğŸ‰ä½ ä¸­äº†" + title;
          if (currentIndex == 4) {
            media_sorry.play();
            txt = "ğŸ˜­å¾ˆé—æ†¾ä½ ä¸­äº†" + title;
          } else {
            media_success.play();
          }
          alert(txt + "~");
        },
      });
    </script>
    <script>
      /**
       * Created by dave on 2023/06/13.
       */

      function canvasLine(bg = "#56bc8a", color = "#fff") {
        // è·å–å…ƒç´ çš„å±æ€§å€¼ï¼Œå¦‚æœå±æ€§å€¼ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é»˜è®¤
        function o(w, v, i) {
          return w.getAttribute(v) || i;
        }
        // å‡½æ•°ç”¨äºè·å–æŒ‡å®šæ ‡ç­¾åç§°çš„å…ƒç´ é›†åˆã€‚
        function j(i) {
          return document.getElementsByTagName(i);
        }

        function l() {
          var i = j("script"),
            w = i.length,
            v = i[w - 1];
          return {
            l: w,
            z: o(v, "zIndex", 1),
            c: o(v, "color", "255,255,255"),
            n: o(v, "count", 99),
          };
        }
        // è®¾ç½®ç”»å¸ƒçš„å®½åº¦å’Œé«˜åº¦ï¼Œå°†å…¶è°ƒæ•´ä¸ºä¸çª—å£æˆ–æ–‡æ¡£çš„å¯è§åŒºåŸŸå¤§å°ç›¸åŒ
        function k() {
          (r = u.width =
            window.innerWidth ||
            document.documentElement.clientWidth ||
            document.body.clientWidth),
            (n = u.height =
              window.innerHeight ||
              document.documentElement.clientHeight ||
              document.body.clientHeight);
        }
        // åŠ¨ç”»ç»˜åˆ¶å‡½æ•°ï¼Œç”»å¸ƒä¸Šç»˜åˆ¶çº¿æ¡å’Œç²’å­æ•ˆæœ
        function b() {
          e.clearRect(0, 0, r, n);
          var w = [f].concat(t);
          var x, v, A, B, z, y;
          t.forEach(function (i) {
            (i.x += i.xa),
              (i.y += i.ya),
              (i.xa *= i.x > r || i.x < 0 ? -1 : 1),
              (i.ya *= i.y > n || i.y < 0 ? -1 : 1),
              e.fillRect(i.x - 0.5, i.y - 0.5, 1, 1);
            for (v = 0; v < w.length; v++) {
              x = w[v];
              if (i !== x && null !== x.x && null !== x.y) {
                (B = i.x - x.x), (z = i.y - x.y), (y = B * B + z * z);
                y < x.max &&
                  (x === f &&
                    y >= x.max / 2 &&
                    ((i.x -= 0.03 * B), (i.y -= 0.03 * z)),
                  (A = (x.max - y) / x.max),
                  e.beginPath(),
                  (e.lineWidth = A),
                  (e.strokeStyle = color),
                  e.moveTo(i.x, i.y),
                  e.lineTo(x.x, x.y),
                  e.stroke());
              }
            }
            w.splice(w.indexOf(i), 1);
          }),
            m(b);
        }

        var u = document.createElement("canvas"),
          s = l(),
          c = "c_n" + s.l,
          e = u.getContext("2d"),
          r,
          n,
          m =
            window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function (i) {
              window.setTimeout(i, 1000 / 45); // çº¦æ¯ç§’ 45 å¸§çš„é€Ÿåº¦è¿›è¡Œæ›´æ–°å’Œç»˜åˆ¶
            },
          a = Math.random,
          f = { x: null, y: null, max: 20000 };
        u.id = c;
        u.style.cssText =
          "position:fixed;top:0;left:0;z-index:" +
          s.z +
          ";background-color:" +
          bg;
        j("body")[0].appendChild(u);
        k(), (window.onresize = k);
        (window.onmousemove = function (i) {
          (i = i || window.event), (f.x = i.clientX), (f.y = i.clientY);
        }),
          (window.onmouseout = function () {
            (f.x = null), (f.y = null);
          });
        u.addEventListener("touchmove", function (e) {
          e.preventDefault();
          f.x = e.touches[0].clientX;
          f.y = e.touches[0].clientY;
        });

        u.addEventListener("touchend", function () {
          f.x = null;
          f.y = null;
        });
        for (var t = [], p = 0; s.n > p; p++) {
          var h = a() * r,
            g = a() * n,
            q = 2 * a() - 1, // äº§ç”ŸèŒƒå›´åœ¨ -1 åˆ° 1 ä¹‹é—´çš„æ°´å¹³é€Ÿåº¦æˆ–è¿åŠ¨æ–¹å‘
            d = 2 * a() - 1;
          t.push({ x: h, y: g, xa: q, ya: d, max: 6000 }); // x,y,
        }
        setTimeout(function () {
          b();
        }, 100);
      }
    </script>
    <script>
      canvasLine(bgColor, lineColor);
    </script>
  </body>
</html>
