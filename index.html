<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lucky</title>
    <style>
      html,
      body {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: #ffa39e;
      }

      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      #root {
        position: absolute;
        left: 50%;
        top: 60px;
        width: 800px;
        margin-left: -400px;
        z-index: 2;
      }
      #lucky {
        margin: 0 auto;
      }
      .h3 {
        width: 100%;
        text-align: center;
        margin-bottom: 30px;
        color: #fff;
      }
      @media screen and (max-width: 414px) {
        #root {
          width: 100%;
          left: 0;
          margin-left: initial;
        }
      }
    </style>
    <script src="https://unpkg.com/lucky-canvas@1.7.25"></script>
  </head>
  <body>
    <div id="root">
      <h1 class="h3">南门小学期末抽奖</h1>
      <div id="lucky"></div>
    </div>
    <script>
      // 转盘变量
      const lightColor = "#ffe58f";
      const weightColor = "#ffd666";
      const delay = 2000; // 转盘停止延迟时间 单位: 秒

      // 背景变量
      const bgColor = "#ffa39e"; // 背景粉色
      const lineColor = "#fff"; // 线条颜色 白色

      // 浏览器宽度
      const outerWidth = window.outerWidth;

      // 奖品列表
      const prizes = [
        {
          background: lightColor,
          fonts: [{ text: "卡通橡皮", top: "15px" }],
          weight: 0.25,
        },
        {
          background: weightColor,
          fonts: [{ text: "太空人不倒翁", top: "15px" }],
          weight: 0.25,
        },
        {
          background: lightColor,
          fonts: [{ text: "贴纸卡片奖状任选", top: "15px" }],
          weight: 0.1,
        },
        {
          background: weightColor,
          fonts: [{ text: "期末成绩A+", top: "15px" }],
          weight: 0.3,
        },
        {
          background: "#ffffff",
          fonts: [{ text: "谢谢惠顾", top: "15px" }],
          weight: 0.1,
        },
      ];

      const weights = prizes.map((itm) => itm.weight);

      // 权重之和
      const totalWeight = weights.reduce((acc, curr) => acc + curr, 0);

      //权重函数
      function lottery() {
        const probability = Math.random();
        let cumulativeProbability = 0;
        for (let i = 0; i < weights.length; i++) {
          cumulativeProbability += weights[i] / totalWeight;
          if (probability < cumulativeProbability) {
            return i;
          }
        }
        return null;
      }
      // 定时器
      var timer = null;

      // 转盘
      const myLucky = new LuckyCanvas.LuckyWheel("#lucky", {
        width: outerWidth < 414 ? "350px" : "450px",
        height: outerWidth < 414 ? "350px" : "450px",
        blocks: [{ padding: "20px", background: "#f5222d" }],
        prizes: prizes,
        buttons: [
          { radius: "40%", background: "#ffccc7" },
          { radius: "35%", background: "#ff7875" },
          {
            radius: "30%",
            background: "#f5222d",
            pointer: true,
            fonts: [{ text: "Start", top: "-10px" }],
          },
        ],
        start: function () {
          // 开始游戏
          myLucky.play();
          if (timer) {
            clearTimeout(timer);
            timer = null;
          }

          timer = setTimeout(() => {
            const index = lottery();
            myLucky.stop(index);
          }, delay);
        },
      });
    </script>
    <script>
      /**
       * Created by dave on 2023/06/13.
       */

      function canvasLine(bg = "#56bc8a", color = "#fff") {
        // 获取元素的属性值，如果属性值不存在，则返回默认
        function o(w, v, i) {
          return w.getAttribute(v) || i;
        }
        // 函数用于获取指定标签名称的元素集合。
        function j(i) {
          return document.getElementsByTagName(i);
        }

        function l() {
          var i = j("script"),
            w = i.length,
            v = i[w - 1];
          return {
            l: w,
            z: o(v, "zIndex", 1),
            c: o(v, "color", "255,255,255"),
            n: o(v, "count", 99),
          };
        }
        // 设置画布的宽度和高度，将其调整为与窗口或文档的可见区域大小相同
        function k() {
          (r = u.width =
            window.innerWidth ||
            document.documentElement.clientWidth ||
            document.body.clientWidth),
            (n = u.height =
              window.innerHeight ||
              document.documentElement.clientHeight ||
              document.body.clientHeight);
        }
        // 动画绘制函数，画布上绘制线条和粒子效果
        function b() {
          e.clearRect(0, 0, r, n);
          var w = [f].concat(t);
          var x, v, A, B, z, y;
          t.forEach(function (i) {
            (i.x += i.xa),
              (i.y += i.ya),
              (i.xa *= i.x > r || i.x < 0 ? -1 : 1),
              (i.ya *= i.y > n || i.y < 0 ? -1 : 1),
              e.fillRect(i.x - 0.5, i.y - 0.5, 1, 1);
            for (v = 0; v < w.length; v++) {
              x = w[v];
              if (i !== x && null !== x.x && null !== x.y) {
                (B = i.x - x.x), (z = i.y - x.y), (y = B * B + z * z);
                y < x.max &&
                  (x === f &&
                    y >= x.max / 2 &&
                    ((i.x -= 0.03 * B), (i.y -= 0.03 * z)),
                  (A = (x.max - y) / x.max),
                  e.beginPath(),
                  (e.lineWidth = A),
                  (e.strokeStyle = color),
                  e.moveTo(i.x, i.y),
                  e.lineTo(x.x, x.y),
                  e.stroke());
              }
            }
            w.splice(w.indexOf(i), 1);
          }),
            m(b);
        }

        var u = document.createElement("canvas"),
          s = l(),
          c = "c_n" + s.l,
          e = u.getContext("2d"),
          r,
          n,
          m =
            window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function (i) {
              window.setTimeout(i, 1000 / 45); // 约每秒 45 帧的速度进行更新和绘制
            },
          a = Math.random,
          f = { x: null, y: null, max: 20000 };
        u.id = c;
        u.style.cssText =
          "position:fixed;top:0;left:0;z-index:" +
          s.z +
          ";background-color:" +
          bg;
        j("body")[0].appendChild(u);
        k(), (window.onresize = k);
        (window.onmousemove = function (i) {
          (i = i || window.event), (f.x = i.clientX), (f.y = i.clientY);
        }),
          (window.onmouseout = function () {
            (f.x = null), (f.y = null);
          });
        u.addEventListener("touchmove", function (e) {
          e.preventDefault();
          f.x = e.touches[0].clientX;
          f.y = e.touches[0].clientY;
        });

        u.addEventListener("touchend", function () {
          f.x = null;
          f.y = null;
        });
        for (var t = [], p = 0; s.n > p; p++) {
          var h = a() * r,
            g = a() * n,
            q = 2 * a() - 1, // 产生范围在 -1 到 1 之间的水平速度或运动方向
            d = 2 * a() - 1;
          t.push({ x: h, y: g, xa: q, ya: d, max: 6000 }); // x,y,
        }
        setTimeout(function () {
          b();
        }, 100);
      }
    </script>
    <script>
      canvasLine(bgColor, lineColor);
    </script>
  </body>
</html>
